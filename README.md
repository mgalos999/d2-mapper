# d2-mapper

This repo takes data generated by this project <https://github.com/blacha/diablo2/tree/master/packages/map> and creates SVGs.

At the moment this project simply takes one sample output `src/data/hell.json` and generates SVGs from it.
However if you get that above package working you can generate JSON payloads of any given map seed.

![Durance of hate level 2](duranceofhate.png)

### IMPORTANT

## Setup backend

This repo does not include the backend server.
Please refer to <https://github.com/blacha/diablo2/tree/master/packages/map>

However to get backend working:

* Install Diablo 2 LOD 1.14b
* Install Project Diablo 2
* Install docker

```bash
docker pull blacha/diablo2
docker run -it -v "/E/Games/Diablo II":/app/game docker.io/blacha/diablo2:latest /bin/bash
wine regedit /app/d2.install.reg
wine bin/d2-map.exe game --seed 10 --level 1 --difficulty 0
```

The last wine command tests that it's working

This command will run a REST API server on port 8899:

```bash
docker run -v "/E/Games/Diablo II":/app/game -p 8899:8899 docker.io/blacha/diablo2:latest
```

### Install

```bash
npm install
npm build
```

### Execute

```bash
npm run generate
```

This will generate SVGs for every level in `build/maps` folder.

In `index.ts` you can set a different seed value.
When a new request is made, the response data is cached.

This repo has an already cached response for 26396577/Hell and 1294978398/Hell so you can run this without a backed for those 2 settings.

### Notes

* Purple box for exits
* Red dot for monsters
* Yellow box for waypoint.

## TODO

* Hook this up to an API to generate from live data
* Special icons/markings for exits and special items needs to be improved
* More reliable creation of SVG, seems rotating seems to create issues with centering the image in the viewbox
